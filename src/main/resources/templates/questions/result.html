<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<body>

<div class="container">

    <div th:replace="fragments/bodyHeader :: bodyHeader" />

    <div class="py-4 text-center">
        <h4>테스트 결과</h4>
    </div>

    <hr class="my-4">

        <div class="form-row">
            <div class="col-md-4">
                <canvas id="myChart"></canvas>
            </div>
            <div class="col-md-8">
                <h1 th:text="${r.success_cd_nm}" style="font-weight: 900" th:classappend="${r.success_cd_nm eq '합격'? 'text-success':'text-danger'}"></h1>
                <p th:text="|(합격하려면 ${r.success_per}%를 달성해야 함)|"></p>
                <ul class="list-inline">
                    <li class="list-inline-item"><h2 th:text="|${r.correct_per}% 정답|"></h2></li>
                    <li class="list-inline-item"><p th:text="|(${r.correct_cnt} / ${r.total_q_cnt})|"></p></li>
                </ul>
                <p th:text="|${r.start_dt} - ${r.end_dt}|"></p>
                <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                    상세 문제 검토
                </button>
            </div>
        </div>

<!--    <p>-->
<!--        <a class="btn btn-secondary" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">-->
<!--            Link with href-->
<!--        </a>-->
<!--        -->
<!--    </p>-->
    <div class="collapse" id="collapseExample">
        <hr class="my-4">
        <div th:unless="${#lists.isEmpty(r.resultDetails)}" th:each="detail, stat : ${r.resultDetails}" >
            <div th:replace="fragments/resultDetail :: resultDetail(detail=${detail})"></div>
        </div>
    </div>

    <div th:replace="fragments/footer :: footer"></div>

</div> <!-- /container -->

    <script th:inline="javascript">

        let correct_cnt;
        let wrong_cnt;

        $(document).ready(function(){
            correct_cnt = [[${r.correct_cnt}]];
            wrong_cnt = [[${r.wrong_cnt}]];

            const data = {
                labels: [
                    '맞음',
                    '틀림',
                ],
                datasets: [{
                    label: 'My First Dataset',
                    data: [correct_cnt, wrong_cnt],
                    backgroundColor: [
                        'rgb(54, 162, 235)',
                        'rgb(255, 99, 132)'
                        // 'rgb(255, 205, 86)'
                    ],
                    hoverOffset: 4
                }]
            };

            const config = {
                type: 'doughnut',
                data: data,
                options : {
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            };

            const myChart = new Chart(
                document.getElementById('myChart'),
                config
            );
        });


    </script>
</body>
</html>